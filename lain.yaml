appname: webrouter

build:
  base: laincloud/centos-lain-webrouter:20170227
  prepare:
    version: "201"
    script:
      - pip install -r pip-req.txt --index-url https://pypi.doubanio.com/simple
  script:
    - cp logrotate.d/* /etc/logrotate.d/

test:
  script:
    - mkdir -p /var/log/watcher
    - make test-cov

worker:
  cmd: /usr/bin/supervisord
  env:
    - LAINLET_PORT=9001
    - GRAPHITE_PORT=2003
  memory: 256m
  setup_time: 60
  volumes:
    - /etc/nginx/conf.d
    - /etc/nginx/upstreams
    - /etc/nginx/locations
    - /etc/nginx/buffer
    - /var/log/nginx
    - /var/log/watcher
    - /var/log/supervisor

notify:
  slack: "#lain"
